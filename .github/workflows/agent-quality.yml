# Agent Quality Check Workflow
# Generated by Security Scanner Agent
# Runs automated quality checks on every push

name: Agent Quality Checks

on:
  push:
    branches: [ main, develop, 'claude/**' ]
  pull_request:
    branches: [ main, develop ]

jobs:
  quality-check:
    name: Code Quality and Security
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20.x'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Run build
        run: npm run build

      - name: Run tests
        run: npm test
        continue-on-error: true

      - name: Security audit
        run: npm audit --audit-level=moderate
        continue-on-error: true

      - name: Check TypeScript types
        run: npx tsc --noEmit
        continue-on-error: true

      - name: Agent system health check
        run: |
          echo "Checking agent deployment capabilities..."
          node -e "
            import('./dist/src/agents.js').then(({ agentRegistry }) => {
              const stats = agentRegistry.getStats();
              console.log('✅ Agent Registry operational');
              console.log('   Total agents:', stats.total);
              console.log('   Categories:', stats.categories);
            }).catch(err => {
              console.error('❌ Agent Registry check failed:', err.message);
              process.exit(1);
            });
          "

  deployment-test:
    name: Agent Deployment Test
    runs-on: ubuntu-latest
    needs: quality-check

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20.x'
          cache: 'npm'

      - name: Install and build
        run: |
          npm ci
          npm run build

      - name: Test agent deployment
        run: |
          echo "Testing agent deployment at scale..."
          node -e "
            import('./dist/src/agents.js').then(({ agentRegistry }) => {
              const agents = agentRegistry.generateAgents(50);
              agents.forEach(agent => agentRegistry.deploy(agent));
              const stats = agentRegistry.getStats();
              console.log('✅ Deployed', stats.total, 'agents successfully');
              if (stats.total < 50) {
                console.error('❌ Expected at least 50 agents');
                process.exit(1);
              }
            }).catch(err => {
              console.error('❌ Deployment test failed:', err.message);
              process.exit(1);
            });
          "

      - name: Test parallel execution
        run: |
          echo "Testing parallel command execution..."
          node -e "
            import('./dist/src/parallel-executor.js').then(({ executeParallel }) => {
              const commands = [
                { command: 'echo', args: ['test1'] },
                { command: 'echo', args: ['test2'] },
                { command: 'echo', args: ['test3'] }
              ];
              return executeParallel(commands);
            }).then(results => {
              const success = results.filter(r => r.success).length;
              console.log('✅ Parallel execution:', success + '/' + results.length, 'successful');
              if (success !== results.length) {
                console.error('❌ Not all commands succeeded');
                process.exit(1);
              }
            }).catch(err => {
              console.error('❌ Parallel execution test failed:', err.message);
              process.exit(1);
            });
          "

# Generated by Security Scanner Agent
# This workflow ensures agent system quality and reliability
