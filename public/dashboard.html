<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A2A Agent Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 5px rgba(59, 130, 246, 0.5); }
            50% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.8); }
        }
        .pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function Dashboard() {
            const [metrics, setMetrics] = useState(null);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [autoRefresh, setAutoRefresh] = useState(true);

            const fetchMetrics = async () => {
                try {
                    setLoading(true);
                    const response = await fetch('/api/dashboard');
                    if (!response.ok) throw new Error('Failed to fetch metrics');
                    const data = await response.json();
                    setMetrics(data);
                    setError(null);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => {
                fetchMetrics();
                if (autoRefresh) {
                    const interval = setInterval(fetchMetrics, 5000);
                    return () => clearInterval(interval);
                }
            }, [autoRefresh]);

            const MetricCard = ({ title, value, icon, color }) => (
                <div className={`bg-gray-800 rounded-lg p-6 border-2 ${color} pulse-glow`}>
                    <div className="flex items-center justify-between">
                        <div>
                            <p className="text-gray-400 text-sm uppercase tracking-wide">{title}</p>
                            <p className="text-3xl font-bold mt-2">{value}</p>
                        </div>
                        <div className="text-4xl">{icon}</div>
                    </div>
                </div>
            );

            if (loading && !metrics) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="text-center">
                            <div className="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-blue-500 mx-auto"></div>
                            <p className="mt-4 text-xl">Loading Dashboard...</p>
                        </div>
                    </div>
                );
            }

            if (error) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="bg-red-900 border border-red-700 rounded-lg p-8 max-w-md">
                            <h2 className="text-2xl font-bold mb-4">‚ö†Ô∏è Error</h2>
                            <p className="text-red-200">{error}</p>
                            <button 
                                onClick={fetchMetrics}
                                className="mt-4 bg-red-700 hover:bg-red-600 px-4 py-2 rounded"
                            >
                                Retry
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-gray-900">
                    {/* Header */}
                    <header className="bg-gray-800 border-b border-gray-700 sticky top-0 z-10">
                        <div className="container mx-auto px-6 py-4">
                            <div className="flex items-center justify-between">
                                <div>
                                    <h1 className="text-3xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">
                                        ü§ñ A2A Agent Dashboard
                                    </h1>
                                    <p className="text-gray-400 text-sm mt-1">Real-time Agent Monitoring System</p>
                                </div>
                                <div className="flex items-center gap-4">
                                    <label className="flex items-center gap-2 cursor-pointer">
                                        <input 
                                            type="checkbox" 
                                            checked={autoRefresh}
                                            onChange={(e) => setAutoRefresh(e.target.checked)}
                                            className="w-5 h-5"
                                        />
                                        <span className="text-sm">Auto-refresh</span>
                                    </label>
                                    <button 
                                        onClick={fetchMetrics}
                                        className="bg-blue-600 hover:bg-blue-500 px-4 py-2 rounded-lg font-medium transition"
                                    >
                                        üîÑ Refresh
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="container mx-auto px-6 py-8">
                        {/* System Status */}
                        <div className="bg-gray-800 rounded-lg p-6 mb-8 border border-gray-700">
                            <h2 className="text-2xl font-bold mb-4">System Status</h2>
                            <div className="flex items-center gap-3">
                                <div className="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                                <span className="text-lg">Status: <span className="text-green-400 font-semibold">{metrics?.status || 'online'}</span></span>
                            </div>
                            <p className="text-gray-400 mt-2">Last updated: {new Date().toLocaleString()}</p>
                        </div>

                        {/* Metrics Grid */}
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                            <MetricCard 
                                title="Total Requests"
                                value={metrics?.metrics?.requests?.total || 0}
                                icon="üìä"
                                color="border-blue-500"
                            />
                            <MetricCard 
                                title="Success Rate"
                                value={`${((metrics?.metrics?.requests?.success / metrics?.metrics?.requests?.total * 100) || 0).toFixed(1)}%`}
                                icon="‚úÖ"
                                color="border-green-500"
                            />
                            <MetricCard 
                                title="Active Agents"
                                value={metrics?.metrics?.agents?.active || 0}
                                icon="ü§ñ"
                                color="border-purple-500"
                            />
                            <MetricCard 
                                title="Avg Response Time"
                                value={`${metrics?.metrics?.performance?.avgResponseTime || 0}ms`}
                                icon="‚ö°"
                                color="border-yellow-500"
                            />
                        </div>

                        {/* Detailed Metrics */}
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            {/* Agent Stats */}
                            <div className="bg-gray-800 rounded-lg p-6 border border-gray-700">
                                <h3 className="text-xl font-bold mb-4">ü§ñ Agent Statistics</h3>
                                <div className="space-y-3">
                                    <div className="flex justify-between items-center">
                                        <span className="text-gray-400">Active Agents:</span>
                                        <span className="font-semibold text-purple-400">{metrics?.metrics?.agents?.active || 0}</span>
                                    </div>
                                    <div className="flex justify-between items-center">
                                        <span className="text-gray-400">Total Agents:</span>
                                        <span className="font-semibold">{metrics?.metrics?.agents?.total || 0}</span>
                                    </div>
                                    <div className="flex justify-between items-center">
                                        <span className="text-gray-400">Agent Uptime:</span>
                                        <span className="font-semibold text-green-400">99.9%</span>
                                    </div>
                                </div>
                            </div>

                            {/* Performance Metrics */}
                            <div className="bg-gray-800 rounded-lg p-6 border border-gray-700">
                                <h3 className="text-xl font-bold mb-4">‚ö° Performance Metrics</h3>
                                <div className="space-y-3">
                                    <div className="flex justify-between items-center">
                                        <span className="text-gray-400">Avg Response Time:</span>
                                        <span className="font-semibold text-yellow-400">{metrics?.metrics?.performance?.avgResponseTime || 0}ms</span>
                                    </div>
                                    <div className="flex justify-between items-center">
                                        <span className="text-gray-400">Memory Usage:</span>
                                        <span className="font-semibold">{metrics?.metrics?.performance?.memoryUsage || '0MB'}</span>
                                    </div>
                                    <div className="flex justify-between items-center">
                                        <span className="text-gray-400">CPU Usage:</span>
                                        <span className="font-semibold">{metrics?.metrics?.performance?.cpuUsage || '0%'}</span>
                                    </div>
                                </div>
                            </div>

                            {/* Request Stats */}
                            <div className="bg-gray-800 rounded-lg p-6 border border-gray-700">
                                <h3 className="text-xl font-bold mb-4">üìà Request Statistics</h3>
                                <div className="space-y-3">
                                    <div className="flex justify-between items-center">
                                        <span className="text-gray-400">Total Requests:</span>
                                        <span className="font-semibold">{metrics?.metrics?.requests?.total || 0}</span>
                                    </div>
                                    <div className="flex justify-between items-center">
                                        <span className="text-gray-400">Successful:</span>
                                        <span className="font-semibold text-green-400">{metrics?.metrics?.requests?.success || 0}</span>
                                    </div>
                                    <div className="flex justify-between items-center">
                                        <span className="text-gray-400">Failed:</span>
                                        <span className="font-semibold text-red-400">{metrics?.metrics?.requests?.failed || 0}</span>
                                    </div>
                                </div>
                            </div>

                            {/* System Info */}
                            <div className="bg-gray-800 rounded-lg p-6 border border-gray-700">
                                <h3 className="text-xl font-bold mb-4">‚ÑπÔ∏è System Information</h3>
                                <div className="space-y-3">
                                    <div className="flex justify-between items-center">
                                        <span className="text-gray-400">Version:</span>
                                        <span className="font-semibold">{metrics?.version || '1.0.0'}</span>
                                    </div>
                                    <div className="flex justify-between items-center">
                                        <span className="text-gray-400">Environment:</span>
                                        <span className="font-semibold">{metrics?.environment || 'production'}</span>
                                    </div>
                                    <div className="flex justify-between items-center">
                                        <span className="text-gray-400">Deployment:</span>
                                        <span className="font-semibold text-blue-400">Vercel</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </main>

                    {/* Footer */}
                    <footer className="bg-gray-800 border-t border-gray-700 mt-12 py-6">
                        <div className="container mx-auto px-6 text-center text-gray-400">
                            <p>A2A Agent Dashboard ¬© 2025 | Powered by Scarmonit</p>
                        </div>
                    </footer>
                </div>
            );
        }

        ReactDOM.render(<Dashboard />, document.getElementById('root'));
    </script>
</body>
</html>
